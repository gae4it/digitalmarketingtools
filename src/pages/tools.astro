---
import Layout from "@/layouts/Layout.astro";
import Container from "@/components/container.astro";
import { Image, getImage } from "astro:assets";
import bookmarks from "@/data/bookmarks.json";
import Pagetitle from "@/components/pagetitle.astro";

import ToolCard from "@/components/ToolCard.astro";
import FilterButton from "@/components/FilterButton.astro";

// Extract unique categories
const categories = ["All", ...Array.from(new Set(bookmarks.map(tool => tool.category))).sort()];
---

<Layout title="Tools">
  <Container>
    <Pagetitle>
      <Fragment slot="title">Tools</Fragment>
      <Fragment slot="desc">Here an amazing collection of tools</Fragment>
    </Pagetitle>

    <!-- Category Filter Buttons -->
    <div class="flex flex-wrap gap-2 justify-center mt-8 mb-8">
      {categories.map(category => (
        <FilterButton 
          label={category} 
          dataAttribute="data-category" 
          value={category} 
        />
      ))}
    </div>

    <!-- Tool Cards -->
    <div class="flex flex-wrap justify-center gap-8 mt-4">
      {bookmarks.map((tool) => (
        <div class="tool-card w-full sm:w-[45%] md:w-[22%] max-w-xs mb-6 flex" data-category={tool.category}>
          <ToolCard tool={tool} />
        </div>
      ))}
    </div>

    <script>
      let selectedCategory = "All";

      function updateFilter(category: string) {
        selectedCategory = category;
        
        // Update button styles
        document.querySelectorAll('.filter-btn').forEach(btn => {
          const btnCategory = btn.getAttribute('data-category');
          if (btnCategory === category) {
            btn.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
            btn.classList.remove('bg-white', 'dark:bg-[#1a2636]', 'text-gray-700', 'dark:text-gray-200', 'border-gray-300', 'dark:border-gray-700');
            btn.setAttribute('aria-pressed', 'true');
          } else {
            btn.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
            btn.classList.add('bg-white', 'dark:bg-[#1a2636]', 'text-gray-700', 'dark:text-gray-200', 'border-gray-300', 'dark:border-gray-700');
            btn.setAttribute('aria-pressed', 'false');
          }
        });

        // Filter tool cards
        document.querySelectorAll('.tool-card').forEach(card => {
          const cardCategory = card.getAttribute('data-category');
          if (category === 'All' || cardCategory === category) {
            (card as HTMLElement).style.display = 'flex';
          } else {
            (card as HTMLElement).style.display = 'none';
          }
        });
      }

      // Add click listeners to filter buttons
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const category = btn.getAttribute('data-category');
          if (category) updateFilter(category);
        });
      });

      // Initialize with "All" selected
      updateFilter('All');
    </script>
  </Container>
</Layout>
