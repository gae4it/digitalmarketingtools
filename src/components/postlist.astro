---
import cx from "classnames";

import { Image, Picture } from "astro:assets";
import Label from "@/components/ui/label.astro";
import type { Author } from "@/data/authors";
import { authors } from "@/data/authors";
import type { Category } from "@/data/category";
import { categories } from "@/data/category";
import { getFormattedDate } from "@/utils/all";
import { Icon } from "astro-icon/components";

const { post, aspect, preloadImage } = Astro.props;
const author = authors.find((item) => item.slug === post.data.author) as Author;
const category = categories.find(
  (item) => item.slug === post.data.category
);
const fallbackCategory = {
  color: "blue",
  title: post.data.category || "Unknown Category"
};
---

<!-- POST CARD LAYOUT -->
<div class="cursor-pointer group bg-[#1a2636] rounded-xl overflow-hidden shadow-lg h-full flex flex-col">
  <div
    class={cx(
      "relative overflow-hidden transition-all bg-[#1a2636] rounded-tl-xl rounded-tr-xl shadow-lg hover:scale-105",
      aspect === "landscape" ? "aspect-[2/1]" : "aspect-[2/1]"
    )}>
    <a href={"/blog/" + post.slug}>
      {
        post.data.image ? (
          <Picture 
              src={post.data.image} 
              widths={[200, 400, 800]} 
              sizes="(max-width: 640px) 90vw, 480px" 
              alt="Thumbnail" 
              loading={preloadImage ? "eager" : "lazy"} 
              width={800} 
              height={600} 
              class="w-full h-64 object-cover" 
            />
        ) : (
          <span class="absolute w-16 h-16 text-gray-200 -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2">
            <Icon
              class="w-4 h-4 text-black"
              name="heroicons:photo"
            />
          </span>
        )
      }
    </a>
  </div>

  <div class="py-2 px-6">
    <a href="#">
      <Label theme={(category?.color as "blue" | "green" | "orange" | "purple" | "pink") || fallbackCategory.color}>{category?.title || fallbackCategory.title}</Label>
    </a>

    <!-- POST TITLE -->
    <h2
      class="mt-2 text-white text-xl font-bold">
      <a href={"/blog/" + post.slug}>
        <span
          class="bg-gradient-to-r from-green-200 to-green-100 dark:from-purple-800 dark:to-purple-900 bg-[length:0px_10px] bg-left-bottom bg-no-repeat transition-[background-size] duration-500 hover:bg-[length:100%_3px] group-hover:bg-[length:100%_10px]">
          {post.data?.title}
        </span>
      </a>
    </h2>

    <!-- POST EXCERPT -->
    <div>
      { 
         post.data?.excerpt && ( 
           <p class="mt-3 text-gray-400 text-sm leading-relaxed line-clamp-3"> 
             <a href={"/blog/" + post.slug}>{post.data.excerpt}</a> 
           </p> 
         ) 
       }
    </div>

    <div
      class="flex items-center mt-3 space-x-3 text-gray-400">
      <div class="flex items-center gap-3">
        <div class="relative flex-shrink-0 w-5 h-5">
          { 
             author?.image && ( 
               <Image 
                 src={author.image} 
                 alt="Author Photo" 
                 width={40} 
                 height={40} 
                 loading="lazy" 
                 class="rounded-full" 
               /> 
             ) 
           }
        </div>
        <span class="text-sm">{author?.name}</span>
      </div>
      <span class="text-xs text-gray-300 dark:text-gray-600"></span>
    </div>
  </div>
</div>